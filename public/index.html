<!doctype html>
<html>
  <head>
    <title>realtime canvas</title>

    <style id="compiled-css" type="text/css">
      .body{
    background: #eeeeee none repeat scroll 0 0;
}
.paper {
    background: #ffffff none repeat scroll 0 0;
    border: 1px solid #d5d5d5;
    height: 500px;
    border-radius: 5px;
    box-shadow: 0 0 5px #7a7a7a;
    margin: 10px 10px 10px 140px;
}

</style>
    <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
    <script type="text/javascript" src="./js/socket.io.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        var canvas = document.getElementById('draw');
        var context = canvas.getContext('2d');
        var width = window.innerWidth;
        var height = window.innerHeight;
        var socket = io.connect('http://192.168.0.17:3000');
        var mouse = {
          click: false,
          move: false,
          pos: {x: 0, y: 0},
          pos_prev: false
        };

        canvas.width = width;
        canvas.height = height;

        canvas.onmousedown = function (e) { mouse.click = true };
        canvas.onmouseup = function (e) { mouse.click = false };

      //  context.clearRect(0, 0, 300, 20);

        canvas.onmousemove = function (e) {

            var rect = this.getBoundingClientRect();

          //mouse.pos.x = (e.clientX / width);
         // mouse.pos.y = (e.clientY / height);
         mouse.pos.x = e.clientX - rect.left,
         mouse.pos.y = e.clientY - rect.top;
         mouse.move = true;
        };


        socket.on('draw', function (data) {
          
         var line = data.line;
        // console.log(data);
          // context.beginPath();
          // context.moveTo(line[0].x * width, line[0].y * height);
          // context.lineTo(line[1].x * width, line[1].y * height);
          // context.stroke(); 
          context.beginPath();
	        context.moveTo(line[0].x , line[0].y);
	        context.lineTo(line[1].x, line[1].y);
	       // context.strokeStyle = x;
	       // context.lineWidth = y;
	        context.stroke();
	        context.closePath();

          
        });


        function loop () {
          if (mouse.click && mouse.move && mouse.pos_prev) {
            socket.emit('draw', { line: [ mouse.pos, mouse.pos_prev ] });
            mouse.move = false;
          }
          mouse.pos_prev = { x: mouse.pos.x, y:mouse.pos.y};
          setTimeout(loop, 25); 
        }

        loop();
        document.getElementById("draw").style.cursor = "pointer";
      });


    </script>
  </head>
  <body>
    <div class="paper">
      <canvas id="draw" style="width:100%; height:100%;border: 1px solid #000"></canvas>
  </div>
   
  </body>
</html>